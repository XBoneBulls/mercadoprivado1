
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Passo-a-Passo para Integrar - ACESSOGOV - MERCADO PRIVADO</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#autenticacao" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ACESSOGOV - MERCADO PRIVADO" class="md-header__button md-logo" aria-label="ACESSOGOV - MERCADO PRIVADO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACESSOGOV - MERCADO PRIVADO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Passo-a-Passo para Integrar
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Modo noturno"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Modo noturno" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-blue" data-md-color-accent=""  aria-label="Modo claro"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Modo claro" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ACESSOGOV - MERCADO PRIVADO" class="md-nav__button md-logo" aria-label="ACESSOGOV - MERCADO PRIVADO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ACESSOGOV - MERCADO PRIVADO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Legislação e Conceitos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Legislação e Conceitos" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Legislação e Conceitos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LEGISLACAO_E_CONCEITOS/vertopal.com_introdu%C3%A7%C3%A3o/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LEGISLACAO_E_CONCEITOS/vertopal.com_contexto/" class="md-nav__link">
        Contexto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LEGISLACAO_E_CONCEITOS/vertopal.com_catalogoconfiabilidades/" class="md-nav__link">
        Catalogo de Confiabilidades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../LEGISLACAO_E_CONCEITOS/vertopal.com_escopoatributos/" class="md-nav__link">
        Escopo de atributos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Informações Técnicas para Integração
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Informações Técnicas para Integração" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Informações Técnicas para Integração
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vertopal.com_chavepgp/" class="md-nav__link">
        Chave Pgp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vertopal.com_solicitarconfiguracao/" class="md-nav__link">
        Solicitar configuração
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Configurar a integração
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Configurar a integração
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passo-1" class="md-nav__link">
    Passo 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-2" class="md-nav__link">
    Passo 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-3" class="md-nav__link">
    Passo 3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-4" class="md-nav__link">
    Passo 4
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-5" class="md-nav__link">
    Passo 5
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-6" class="md-nav__link">
    Passo 6
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-7" class="md-nav__link">
    Passo 7
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-8" class="md-nav__link">
    Passo 8
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-9" class="md-nav__link">
    Passo 9
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-10" class="md-nav__link">
    Passo 10
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vertopal.com_exemplointegracao/" class="md-nav__link">
        Exemplo de implementação
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vertopal.com_execucaoexemplo/" class="md-nav__link">
        Execução do exemplo de implementação
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passo-1" class="md-nav__link">
    Passo 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-2" class="md-nav__link">
    Passo 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-3" class="md-nav__link">
    Passo 3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-4" class="md-nav__link">
    Passo 4
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-5" class="md-nav__link">
    Passo 5
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-6" class="md-nav__link">
    Passo 6
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-7" class="md-nav__link">
    Passo 7
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-8" class="md-nav__link">
    Passo 8
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-9" class="md-nav__link">
    Passo 9
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#passo-10" class="md-nav__link">
    Passo 10
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="autenticacao">Autenticação</h1>
<p>Para que a autenticação aconteça, todo o canal de comunicação deve ser
realizado com o protocolo HTTPS e, não utilizar a tecnologia WebView no
ambiente mobile, mas navegador nativo. Será feito um redirecionamento
para uma URL de autorização do Login Único e, após a autenticação ser
concluída, retornará um código de autenticação para a aplicação cliente
com intuito de adquirir um ticket de acesso para os serviços protegidos.</p>
<p>Para configuração do ambiente local dos desenvolvedores deve-se
considerar a criação de um domínio para o ambiente de desenvolvimento
das soluções clientes, por exemplo, \"local.minha_aplicacao.gov.br\"
(configurando nas máquinas dos desenvolvedores - hosts), evitando, desta
forma, a necessidade de configuração de URLs de redirecionamento e
logout fixadas em IPs dos desenvolvedores.</p>
<p>A utilização da autenticação do Login Único depende dos seguintes
passos:</p>
<h2 id="passo-1">Passo 1</h2>
<p>A chamada para autenticação deverá ocorrer pelo botão com o conteúdo
<strong>Entrar com GOV.BR</strong>. Para o formato do botão, seguir as orientações do
<a href="https://dsgov.estaleiro.serpro.gov.br/components/signin?tab=designer">Design
System</a>
.</p>
<h2 id="passo-2">Passo 2</h2>
<p>Ao requisitar autenticação via Provedor, o mesmo verifica se o usuário
está logado. Caso o usuário não esteja logado o provedor redireciona
para a página de login.</p>
<h2 id="passo-3">Passo 3</h2>
<p>A requisição é feita através de um GET para o endereço
<a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/auth">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/auth</a> passando as seguintes
informações:</p>
<table>
<thead>
<tr>
<th><strong>Variavél</strong></th>
<th><strong>Descrição</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>response_type</strong></td>
<td>Especifica para o provedor o tipo de autorização. Neste caso será <strong>code</strong></td>
</tr>
<tr>
<td><strong>client_id</strong></td>
<td>Chave de acesso, que identifica o serviço consumidor fornecido pelo Login Único para a aplicação cadastrada</td>
</tr>
<tr>
<td><strong>scope</strong></td>
<td>Especifica os recursos que o serviço consumidor quer obter. Um ou mais escopos inseridos para a aplicação cadastrada. Exemplo: <strong>openid+email+phone</strong>.</td>
</tr>
<tr>
<td><strong>redirect_uri</strong></td>
<td>URI de retorno cadastrada para a aplicação cliente no formato <em>URL Encode</em>. Este parâmetro não pode conter caracteres especiais conforme consta na especificação <a href="https://tools.ietf.org/html/rfc6749#section-3.1.2">auth 2.0 Redirection Endpoint</a></td>
</tr>
<tr>
<td><strong>nonce</strong></td>
<td>Sequência de caracteres usado para associar uma sessão do serviço consumidor a um <em>Token</em> de ID e para atenuar os ataques de repetição. Pode ser um valor aleatório, mas que não seja de fácil dedução. Item obrigatório.</td>
</tr>
<tr>
<td><strong>state</strong></td>
<td>Valor usado para manter o estado entre a solicitação e o retorno de chamada.</td>
</tr>
<tr>
<td><strong>code_challenge</strong></td>
<td>Senha gerada pelo cliente para proteger o code da requisicao do Authorize. Seguir o padrão BASE64URL-ENCODE(SHA256(ASCII(Valor da Atributo do code_verifier a ser utilizado no /Token))).</td>
</tr>
<tr>
<td><strong>code_challenge_method</strong></td>
<td>Será o método para proteger a senha enviada no parâmetro code_challenge. O padrão será \"S256\".</td>
</tr>
</tbody>
</table>
<p>Exemplo de requisição:</p>
<pre><code class="language-console">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/auth?response_type=code&amp;client_id=ec4318d6-f797-4d65-b4f7-39a33bf4d544&amp;scope=openid+email+phone+profile&amp;redirect_uri=http%3A%2F%2Fappcliente.com.br%2Fphpcliente%2Floginecidadao.Php&amp;nonce=3ed8657fd74c&amp;state=358578ce6728b%code_challenge=K9LToxk012GYrMAwyspMMZZUdP5fpI81_vedD9dO4bI&amp;code_challenge_method=S256
</code></pre>
<p><strong>Observações para Passo 3:</strong></p>
<ul>
<li>Parâmetro <strong>STATE</strong> deve obrigatoriamente ser usado e deve ser
    validado no cliente (validado que foi previamente emitido pelo
    cliente)</li>
<li>Parâmetros <strong>code_challenge e code_challenge_method</strong> devem
    obrigatoriamente ser usado evitando que a resposta do \"authorize\"
    possa ser utilizada por um terceiro agente. Detalhes na <a href="https://datatracker.ietf.org/doc/html/rfc7636">RFC
    PKCE</a></li>
<li>Parâmetro <strong>nonce</strong> é obrigatório e deve ser formado por uma String aleatória. O mesmo <strong>nonce</strong>  estará presente no <strong>ID Token</strong>.</li>
</ul>
<h2 id="passo-4">Passo 4</h2>
<p>Após a autorização, a requisição é retornada para a URL especificada no
redirect_uri especificada no passo anterior,
enviando os parâmetros:</p>
<table>
<thead>
<tr>
<th><strong>Variavél</strong></th>
<th><strong>Descrição</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>code</strong></td>
<td>Código de autenticação gerado pelo provedor. Será utilizado para obtenção do Token de Resposta. Possui tempo de expiração e só pode ser utilizado uma única vez.</td>
</tr>
<tr>
<td><strong>state</strong></td>
<td><em>State</em> gerado no <a href="iniciarintegracao.html#passo-3">Passo 3</a> que pode ser utilizado para controle da aplicação cliente. Pode correlacionar com o <em>code</em> gerado. O cliente consegue saber se o CODE veio de um state gerado por ele.</td>
</tr>
</tbody>
</table>
<h2 id="passo-5">Passo 5</h2>
<p>Após autenticado, o provedor redireciona para a página de autorização. O
usuário habilitará o consumidor no sistema para os escopos solicitados.
Caso o usuário da solicitação autorize o acesso, é gerado um "ticket de
acesso", conforme demonstra na especificação <a href="https://openid.net/specs/openid-connect-core-1_0.html#TokenResponse">OpenID
Connect</a>
;</p>
<h2 id="passo-6">Passo 6</h2>
<p>Para obter o <em>ticket de acesso</em>, o consumidor deve fazer uma requisição
POST para o endereço <a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token</a> passando
as seguintes informações:</p>
<p>Parâmetros do Header para requisição Post
<a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token</a></p>
<table>
<thead>
<tr>
<th><strong>Variavél</strong></th>
<th><strong>Descrição</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Content-Type</strong></td>
<td>Tipo do conteúdo da requisição que está sendo enviada. Nesse caso estamos enviando como um formulário</td>
</tr>
<tr>
<td><strong>Authorization</strong></td>
<td>Informação codificada em <em>Base64</em>, no seguinte formato: CLIENT_ID:CLIENT_SECRET (senha de acesso do serviço consumidor)(utilizar <a href="https://www.base64decode.org/">codificador para Base64</a> [site externo]{.image} para gerar codificação). A palavra Basic deve está antes da informação.</td>
</tr>
</tbody>
</table>
<p>Exemplo de <em>header</em>:</p>
<pre><code class="language-console">Content-Type:application/x-www-form-urlencoded
Authorization: Basic                                            
ZWM0MzE4ZDYtZjc5Ny00ZDY1LWI0ZjctMzlhMzNiZjRkNTQ0OkFJSDRoaXBfTUJYcVJkWEVQSVJkWkdBX2dRdjdWRWZqYlRFT2NWMHlFQll4aE1iYUJzS0xwSzRzdUVkSU5FcS1kNzlyYWpaZ3I0SGJuVUM2WlRXV1lJOA==
</code></pre>
<p>Parâmetros do Body para requisição Post
<a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token</a></p>
<table>
<thead>
<tr>
<th><strong>Variavél</strong></th>
<th><strong>Descrição</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>grant_type</strong></td>
<td>Especifica para o provedor o tipo de autorização. Neste caso será <strong>authorization_code</strong></td>
</tr>
<tr>
<td><strong>code</strong></td>
<td>Código retornado pela requisição anterior (exemplo: Z85qv1)</td>
</tr>
<tr>
<td><strong>redirect_uri</strong></td>
<td>URI de retorno cadastrada para a aplicação cliente. Este parâmetro não pode conter caracteres especiais conforme consta na especificação <a href="https://tools.ietf.org/html/rfc6749#section-3.1.2">auth 2.0 Redirection Endpoint</a></td>
</tr>
<tr>
<td><strong>code_verifier</strong></td>
<td>Senha sem criptografia enviada do parâmetro <strong>code_challenge</strong> presente no <a href="iniciarintegracao.html#passo-3">Passo 3</a>.  O codeVerifier deve ser uma string randômica, ter no mínimo 43 caracteres e no máximo 128.</td>
</tr>
</tbody>
</table>
<p>Exemplo de <em>query</em></p>
<pre><code class="language-console">curl -X POST -d 'grant_type=authorization_code&amp;code=Z85qv1&amp;redirect_uri=http%3A%2F%2Fappcliente.com.br%2Fphpcliente%2Floginecidadao.Php'&amp;code_verifier='saoksdokaosdkasodkasodosdkaodksaodasodsakdaoskdsaok2212121$$2212ybhshsadju' https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/token    
</code></pre>
<p>O serviço retornará, em caso de sucesso, no formato JSON, as informações
conforme exemplo:</p>
<pre><code class="language-JSON">{ 
    &quot;access_token&quot;: &quot;(Token de acesso a recursos protegidos do autenticador, bem como serviços do Login Único.)&quot;, 
    &quot;id_token&quot;: &quot;(Token de autenticação com informações básicas do usuário.)&quot;, 
    &quot;token_type&quot;: &quot;(O tipo do token gerado. Padrão: Bearer)&quot;, 
    &quot;expires_in&quot;: &quot;(Tempo de vida do token em segundos.)&quot; ,
    &quot;refresh_token&quot;: &quot;(Token que atualiza os tokens de acesso, conforme eles expiram)&quot;,
    &quot;refresh_expires_in&quot;: &quot;(Tempo de vida do refresh token em segundos.)&quot;,
    &quot;not-before-policy&quot;: &quot;(data em formato timestamp. Qualquer token com data de publicação anterior a esta data é invalidado.)&quot;
} 
</code></pre>
<p><strong>Observações para Passo 6:</strong></p>
<ul>
<li>Tokens do Acesso gov.br devem ser preferencialmente armazenados no
    backend ou, na hipótese de necessidade de armazenamento no frontend,
    devem ser obrigatoriamente criptografados no backend;</li>
<li>A tela da aplicação cliente que recebe o parâmetro code deve
    obrigatoriamente realizar um redirect para outra página</li>
<li>A aplicação cliente deve ter sessão com mecanismo próprio, evitando
    múltiplas solicitações de autorização ao provedor de identidade do
    Acesso gov.br. O mecanismo próprio isolará a sessão da aplicação
    cliente de regras de negócio e segurança do Acesso gov.br (ou seja,
    o token do Acesso gov.br não deve ser utilizado), permitirá
    autonomia e controle próprios.</li>
<li>Parâmetro <strong>code_verifier</strong> deve obrigatoriamente ser usado evitando
    que a resposta do \"token\" possa ser utilizada por um terceiro
    agente. Detalhes na <a href="https://datatracker.ietf.org/doc/html/rfc7636">RFC
    PKCE</a></li>
</ul>
<h2 id="passo-7">Passo 7</h2>
<p>De posse das informações do json anterior, a aplicação consumidora está
habilitada para consultar dados de recursos protegidos, que são as
informações e método de acesso do usuário ou serviços externos do Login
Único.</p>
<h2 id="passo-8">Passo 8</h2>
<p>Antes de utilizar as informações do JSON anterior, de forma especifica
os <strong>ACCESS_TOKEN</strong> e <strong>ID_TOKEN</strong>, para buscar informações referente ao
método de acesso e cadastro básico do usuário, há necessidade da
aplicação consumidora validar se as informações foram geradas pelos
serviços do Login Único. Esta validação ocorrerá por meio da consulta da
chave pública disponível no serviço
<a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/certs">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/certs</a>. </p>
<h2 id="passo-9">Passo 9</h2>
<p>A utilização das informações do <strong>ACCESS_TOKEN</strong> e <strong>ID_TOKEN</strong> ocorrerá
ao extrair do JSON codificado os seguintes parâmetros:</p>
<p><strong>JSON do ACCESS_TOKEN</strong></p>
<pre><code class="language-JSON">{
    &quot;sub&quot;: &quot;(ID do usuário no Autenticador)&quot;,
    &quot;azp&quot;: &quot;Client ID da aplicação onde o usuário se autenticou&quot;,
    &quot;scope&quot;: [&quot;(Escopos autorizados pelo provedor de autenticação.)&quot;],
    &quot;amr&quot;: [&quot;(Listagem dos fatores de autenticação do usuário. Pode ser “app” se logou por QR-CODE do aplicativo gov.br, “passwd” se o mesmo logou fornecendo a senha, “x509” se o mesmo utilizou certificado digital ou certificado em nuvem, ou “bank” para indicar utilização de conta bancária para autenticar. Esse último seguirá com número de identificação do banco, conforme código de compensação do Bacen presente ao final da explicação.)&quot;],
    &quot;iss&quot;: &quot;(URL do provedor de autenticação que emitiu o token.)&quot;,
    &quot;exp&quot;: &quot;(Data/hora de expiração do token)&quot;,
    &quot;iat&quot;: &quot;(Data/hora em que o token foi emitido.)&quot;,
    &quot;jti&quot;: &quot;(Identificador único do token, reconhecido internamente pelo provedor de autenticação.)&quot;,
    &quot;typ&quot;: &quot;Bearer&quot;,
    &quot;sid&quot;: &quot;(identificador único utilizado na sessão)&quot;,
    &quot;auth_time&quot;: &quot;(indica quando a autenticação ocorreu)&quot;

}
</code></pre>
<p><strong>Observações para ACCESS_TOKEN:</strong></p>
<ul>
<li>Caso um novo método de autenticação seja adicionado, será listado no
    atributo <em>AMR</em>. As integrações devem contemplar futuras adições.</li>
<li>Caso conta do cidadão esteja com segundo fator de autenticação
    ativado, quando o atributo <em>AMR</em> vier com <em>passwd</em>, aparecerão os
    conteúdos <em>mfa</em> (indica presença de segundo fator) e <em>otp</em> (forma de
    segundo fator com código encaminhado pelo aplicativo gov.br).</li>
<li>Documento para verificação do Código de Compensação dos possíveis
    bancos integrados ao Login Único:<a href="https://manual-roteiro-integracao-login-unico.servicos.gov.br/pt/stable/arquivos/TabelaBacen.pdf">Documento verificar Código de
    Compensação dos Bancos</a>.</li>
</ul>
<p><strong>JSON do ID_TOKEN</strong></p>
<pre><code class="language-JSON">{
    &quot;sub&quot;: &quot;(ID do usuário no Autenticador)&quot;,
    &quot;amr&quot;: [&quot;(Listagem dos fatores de autenticação do usuário. Pode ser “app” se logou por QR-CODE do aplicativo gov.br, “passwd” se o mesmo logou fornecendo a senha, “x509” se o mesmo utilizou certificado digital ou certificado em nuvem, ou “bank” para indicar utilização de conta bancária para autenticar. Esse último seguirá com número de identificação do banco, conforme código de compensação do Bacen presente ao final da explicação.)&quot;],
    &quot;name&quot;: &quot;(Nome cadastrado no Gov.br do usuário autenticado.)&quot;,
    &quot;phone_number_verified&quot;: &quot;(Confirma se o telefone foi validado no cadastro do Gov.br. Poderá ter o valor &quot;true&quot; ou &quot;false&quot;)&quot;,
    &quot;phone_number&quot;: &quot;(Número de telefone cadastrado no Gov.br do usuário autenticado. Caso o atributo phone_number_verified do ID_TOKEN tiver o valor false, o atributo phone_number não virá no ID_TOKEN)&quot;,
    &quot;email_verified&quot;: &quot;(Confirma se o email foi validado no cadastro do Gov.br. Poderá ter o valor &quot;true&quot; ou &quot;false&quot;)&quot;,
    &quot;email&quot;: &quot;(Endereço de e-mail cadastrado no Gov.br do usuário autenticado. Caso o atributo email_verified do ID_TOKEN tiver o valor false, o atributo email não virá no ID_TOKEN)&quot;,
    &quot;cnpj&quot;: &quot;(CNPJ vinculado ao usuário autenticado. Atributo será preenchido quando autenticação ocorrer por certificado digital de pessoal jurídica.)&quot;
}
</code></pre>
<p><strong>Observações para ID_TOKEN:</strong></p>
<ul>
<li>Os paramêtros email e phone_number não são obrigatórios. Ambos
    podem estar preenchidos ou não.</li>
<li>Caso um novo método de autenticação seja adicionado, será listado no
    atributo <em>AMR</em>. As integrações devem contemplar futuras adições.</li>
<li>Caso conta do cidadão esteja com segundo fator de autenticação
    ativado, quando o atributo <em>AMR</em> vier com <em>passwd</em>, aparecerão os
    conteúdos <em>mfa</em> (indica presença de segundo fator) e <em>otp</em> (forma de
    segundo fator com código encaminhado pelo aplicativo gov.br).</li>
<li>Documento para verificação do Código de Compensação dos possíveis
    bancos integrados ao Login Único:<a href="https://manual-roteiro-integracao-login-unico.servicos.gov.br/pt/stable/arquivos/TabelaBacen.pdf">Documento verificar Código de
    Compensação dos Bancos</a>.</li>
</ul>
<h2 id="passo-10">Passo 10</h2>
<p>Para verificar quais níveis da conta do cidadão está localizada, deverá
acessar, pelo método GET, o serviço
<a href="https://api.staging.acesso.gov.br/confiabilidades/v3/contas/">https://api.staging.acesso.gov.br/confiabilidades/v3/contas/</a><strong>cpf</strong>/niveis?response-type=ids</p>
<p>Parâmetros para requisição GET
<a href="https://api.staging.acesso.gov.br/confiabilidades/v3/contas/">https://api.staging.acesso.gov.br/confiabilidades/v3/contas/</a><strong>cpf</strong>/niveis?response-type=ids</p>
<p><strong>Variavél</strong>        <strong>Descrição</strong></p>
<hr />
<p><strong>Authorization</strong>   palavra <strong>Bearer</strong> e o <em>ACCESS_TOKEN</em> da requisição POST do <link_confiabilidades>
  <strong>cpf</strong>             CPF do cidadão (sem ponto, barra etc).</p>
<p>A resposta em caso de sucesso retorna sempre um <strong>array</strong> de objetos
JSON no seguinte formato:</p>
<pre><code class="language-JSON">[
    {
    &quot;id&quot;: &quot;(Identificação para reconhecer o nível)&quot;,
    &quot;dataAtualizacao&quot;: &quot;(Mostra a data e hora que ocorreu atualização do nível na conta do usuário. A mascará será YYYY-MM-DD HH:MM:SS)&quot;
    }
]
</code></pre>
<p>Verificar quais níveis estão disponíveis, acesse <a href="https://manual-roteiro-integracao-login-unico.servicos.gov.br/pt/stable/iniciarintegracao.html#resultado-esperado-do-acesso-ao-servico-de-confiabilidade-cadastral-niveis">Resultado Esperado do
Acesso ao Serviço de Confiabilidade Cadastral
(Níveis)</a></p>
<h1 id="acesso-ao-servico-de-catalogo-de-confiabilidades-selos">Acesso ao serviço de Catálogo de Confiabilidades (Selos)</h1>
<ol>
<li>Com usuário autenticado, deverá acessar, por meio do método GET ou
    POST, a URL <a href="https://confiabilidades.staging.acesso.gov.br/">https://confiabilidades.staging.acesso.gov.br/</a></li>
</ol>
<p>Parâmetros da Query para requisição GET
<a href="https://confiabilidades.staging.acesso.gov.br/">https://confiabilidades.staging.acesso.gov.br/</a></p>
<p><strong>Variavél</strong>          <strong>Descrição</strong></p>
<hr />
<p><strong>client_id</strong>         Chave de acesso, que identifica o serviço consumidor fornecido pelo Login Único para a aplicação cadastrada
  <strong>niveis</strong>            Recurso de segurança da informação da identidade, que permitem flexibilidade para realização do acesso. <strong>Atributo opcional</strong>
  <strong>categorias</strong>        Permitem manutenção mais facilitada da utilização dos níveis e confiabilidades (selos) do Login Único. <strong>Atributo obrigatório</strong>
  <strong>confiabilidades</strong>   Consistem em orientar para qualificação das contas com a obtenção dos atributos autoritativos do cidadão a partir das bases oficias, por meio das quais permitirão a utilização da credencial de acesso em sistemas internos dos clientes e serviços providos diretamente ao cidadão. <strong>Atributo obrigatório</strong></p>
<ol>
<li>O resultado será o Catálogo apresentado com as configurações
    solicitadas. Após atendido as configurações, o Login Único devolverá
    o fluxo para aplicação por meio da URL de Lançador de Serviços,
    conforme <a href="https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fmanual-roteiro-integracao-login-unico.servicos.gov.br%2Fpt%2Fstable%2Farquivos%2FModelo_PlanodeIntegracao_LOGINUNICO_Versao-4.doc&amp;wdOrigin=BROWSELINK">Plano de
    Integração</a>.</li>
</ol>
<p><strong>Observações sobre as variáveis do serviço de catálogo</strong></p>
<ol>
<li>Conteúdo para variável <em>niveis</em> : Será a informação do atributo id
    presente em cada nível no <a href="https://manual-roteiro-integracao-login-unico.servicos.gov.br/pt/stable/iniciarintegracao.html#resultado-esperado-do-acesso-ao-servico-de-confiabilidade-cadastral-niveis">Resultado Esperado do Acesso ao Serviço
    de Confiabilidade Cadastral
    (Níveis)</a></li>
<li>Contéudo para variável <em>confiabilidades</em>: Será a informação do
    atributo id presentes em cada confiabilidade no <a href="https://manual-roteiro-integracao-login-unico.servicos.gov.br/pt/stable/iniciarintegracao.html#resultado-esperado-do-acesso-ao-servico-de-confiabilidade-cadastral-selos">Resultado Esperado
    do Acesso ao Serviço de Confiabilidade Cadastral
    (Selos)</a></li>
<li>
<p>Tratamento do conteúdo para cada variável:</p>
</li>
<li>
<p>Todos são obrigatórios, deve-se separá-los por vírgula. <strong>Exemplo
    (confiabilidades=301,801)</strong></p>
</li>
<li>Apenas um é obrigatório, deve-se separar por barra invertida.
    <strong>Exemplo (confiabilidades=(301/801)</strong></li>
</ol>
<h1 id="acesso-ao-servico-de-log-out">Acesso ao Serviço de Log Out</h1>
<ol>
<li><strong>Implementação obrigatória</strong> a fim de encerrar a sessão do usuário
    com o Login Único.</li>
<li>Com usuário autenticado, deverá acessar, por meio do método GET ou
    POST, a URL: <a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout</a>. O acesso ao
    Log Out deverá ser pelo <strong>Front End</strong> da aplicação a ser integrada
    com Login Único.</li>
</ol>
<p>Parâmetros da Query para requisição GET
<a href="https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout">https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout</a></p>
<table>
<thead>
<tr>
<th><strong>Variavél</strong></th>
<th><strong>Descrição</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>post_logout_redirect_uri</strong></td>
<td>URL que direciona ao Login Único qual página deverá ser aberta quando o token for invalidado. A URL deverá ser previamente liberada por meio do preenchimento do campo <strong>URL de Log Out</strong> presente no <a href="arquivos/Modelo_PlanodeIntegracao_LOGINUNICO_Versao-4.doc">Plano de Integração</a>.</td>
</tr>
<tr>
<td><strong>id_token_hint</strong></td>
<td>Cópia do ID Token gerado anteriormente em formato JWT</td>
</tr>
</tbody>
</table>
<p>Exemplo 1 de <strong>execução</strong> no front end em javascript</p>
<pre><code class="language-javascript">var form = document.createElement(&quot;form&quot;);      
form.setAttribute(&quot;method&quot;, &quot;post&quot;);
form.setAttribute(&quot;action&quot;, &quot;https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout?post_logout_redirect_uri=https://www.minha-aplicacao.gov.br/retorno.html&amp;id_token_hint=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI3QXg2dGpHcDl...&quot;);
document.body.appendChild(form);  
form.submit();
</code></pre>
<p>Exemplo 2 de <strong>execução</strong> no front end em javascript</p>
<pre><code class="language-javascript">window.location.href='https://mprivado.validacao.acesso.gov.br/auth/realms/govbrautentica/protocol/openid-connect/logout?post_logout_redirect_uri=https://www.minha-aplicacao.gov.br/retorno.html&amp;id_token_hint=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI3QXg2dGpHcDl...';   
</code></pre>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../vertopal.com_solicitarconfiguracao/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Solicitar configuração" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Solicitar configuração
            </div>
          </div>
        </a>
      
      
        
        <a href="../vertopal.com_exemplointegracao/" class="md-footer__link md-footer__link--next" aria-label="Next: Exemplo de implementação" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Exemplo de implementação
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>